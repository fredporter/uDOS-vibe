# VIBE + uDOS Integration ‚Äî Requirements & Readiness Checklist

**Version:** v1.4.4+
**Last Updated:** 2026-02-22
**Status:** Active

## Current State Summary

### ‚úÖ What's Already in Place

#### 1. **uDOS + Vibe Self-Healing Architecture**
- **Vibe CLI**: Exclusive interactive interface (global Vibe CLI)
- **bin/install-udos-vibe.sh**: Auto-installer for OS detection, uv setup, Vibe install, .env config
- **SETUP command** (`core/commands/setup_handler.py`): First-run identity setup (username, role, timezone, etc.)
- **REPAIR command** (`core/commands/repair_handler.py`): Full system self-check with `--install`, `--upgrade`, `--reset-*` flags
- **SEED command** (`core/commands/seed_handler.py`): Bootstrap vault, memory/bank/, locations, timezones on first run
- **Result**: Automated installer + command self-repair = zero manual setup beyond git clone.

#### 2. **Folder Structure & .gitignore**
- `.gitignore` properly ignores:
  - `memory/` ‚Äî runtime vault vault, logs, databases (created at first run)
  - `*.tomb` ‚Äî encrypted secrets store (created by SETUP, never committed)
  - `.env` ‚Äî local credentials
  - `.vibe/*` except `config.toml`, `tools/`, `skills/` (runtime session files ignored, config committed)
- **vault/** ‚Äî template scaffold (empty). Seed data lives in `core/framework/seed/vault/` ‚Üí installed to `memory/vault/` on first run
- **core/framework/seed/** ‚Äî contains:
  - `locations-seed.json` ‚Äî geographical database starter
  - `timezones-seed.json` ‚Äî timezone fallback data
  - `vault/` ‚Äî Markdown template structure (@inbox, @sandbox, @binders, etc.)
  - `bank/system/` ‚Äî system seed files (help docs, templates, workflows)

#### 3. **Environment & Secrets**
- `.env.example` fully documented with all required fields:
  - **Local identity**: `USER_USERNAME`, `UDOS_TIMEZONE`, `UDOS_LOCATION`, `OS_TYPE`
  - **AI/Mistral**: `MISTRAL_API_KEY` (Vibe CLI required), `MISTRAL_STAGING_API_KEY` (optional)
  - **Wizard server**: `WIZARD_BASE_URL`, `WIZARD_ADMIN_TOKEN` (auto-generated by installer)
  - **Encryption**: `WIZARD_KEY` (auto-generated 64-char hex by installer)
- **First-run flow**:
  ```bash
  git clone https://github.com/fredporter/uDOS-vibe.git
  cd uDOS-vibe
  ./bin/install-udos-vibe.sh     # Auto-configures everything
  vibe                           # Launches interactive interface
  ```

#### 4. **Vibe Integration Ready**
- `.vibe/config.toml` ‚Üí All committe configs for MCP, skill paths, tool paths
- `.vibe/tools/` ‚Üí symlink to `vibe/core/tools/ucode/` (Phase A BaseTool wrappers) ‚Äî already auto-discovered
- `.vibe/skills/` ‚Üí symlink to `vibe/core/skills/ucode/` (Phase A skill markdown files) ‚Äî already auto-discovered
- `pyproject.toml` entry point: `vibe = "vibe.cli.entrypoint:main"` ‚Äî provided by global Vibe CLI install (official curl installer)
- Trust folder system: Vibe asks on first run in a new directory ‚Üí stored in `~/.vibe/trusted-folders`

#### 5. **Dependencies**
- Vibe core: Already pinned in `pyproject.toml` (`mistralai==1.9.11`, `mcp>=1.14.0`, `pydantic>=2.12.4`, etc.)
- uDOS-only deps: Under `[project.optional-dependencies]` `udos` group (tzlocal, pytz, prompt_toolkit, bcrypt, etc.)
- Wizard server (optional): `udos-wizard` group (fastapi, uvicorn, flask, etc.)
- **Install path**: `uv sync --extra udos-wizard` (single repo environment)

---

## ‚ùå What's NOT Yet in Place (But Not Blocking)

### 1. Windows Installation Support
- `bin/install-udos-vibe.sh` works on macOS, Ubuntu, Alpine, other Linux
- **Not yet implemented**: Windows .bat/.ps1 installer equivalent
- **Workaround**: Manual install (curl -fsSL https://vibe.mistral.ai/install.sh | sh, cp .env.example .env, edit .env)

### 2. Wizard Server Auto-Start
- Wizard MCP server (`wizard/mcp/mcp_server.py`) is the stdio bridge to uDOS commands
- **Current**: Start with `uv run --project . wizard/mcp/mcp_server.py` or via managed Vibe MCP config (`uv run --project . scripts/mcp_activation.py enable`)
- **Would be nice**: Auto-start wizard server when Vibe launches (Phase B enhancement)

### 3. Packaged Seed Data in core/framework/seed/
- Locations and timezones seeds exist (JSON)
- But vault/ seeds are minimal; binders/ templates could be richer
- **Not blocking** ‚Äî sane defaults are in place, users can add content over time

---

## üìã Pre-Phase A Checklist

Before scaffolding vibe/core/tools/ucode/ (Phase A tools) and vibe/core/skills/ucode/ (Phase A skills):

### Requirements Check
- [x] Python 3.12+ (pyproject.toml specifies `>=3.12`)
- [x] uv (for dependency management)
- [x] `mcp>=1.14.0` (pinned in vibe deps)
- [x] Pydantic v2 (for BaseTool, models)
- [x] Mistral API key (needed for vibe-cli to function)

### Environment Setup
- [x] `.env.example` has all fields documented
- [x] SETUP story collects local identity interactively
- [x] REPAIR command can reinstall/reset at any point
- [x] SEED command bootstraps vault/memory on first run

### Repository Structure
- [x] vault/ is a template scaffold (never has personal data)
- [x] memory/ is .gitignored and created at first run
- [x] .vibe/ config is committed, runtime sessions are ignored
- [x] core/framework/seed/ has bootstrap data

### Vibe Integration
- [x] vibe/core/tools/ exists with proper `__init__.py`, loader patterns
- [x] vibe/core/skills/ exists with markdown skill loader
- [x] `.vibe/config.toml` references both paths (symlinked to core/)
- [x] Trusted folder system ready

### Secrets & Auth
- [x] .env.local ignored (for dev overrides)
- [x] *.tomb ignored (Wizard keystore)
- [x] WIZARD_KEY auto-generated or user-provided
- [x] MISTRAL_API_KEY read from .env at vibe startup

---

## üöÄ Safe First-Run Experience

### New User Workflow

```bash
# 1. Clone repo with submodules
git clone https://github.com/fredporter/uDOS-vibe.git
cd uDOS-vibe

# 2. Run automated installer (recommended)
./bin/install-udos-vibe.sh
# - Detects OS (macOS, Ubuntu, Alpine, Linux)
# - Installs uv package manager
# - Creates .env with auto-config
# - Installs Vibe CLI
# - Configures uDOS tools/skills
# - Optional: Installs Ollama + models
# - Optional: Installs Wizard MCP server

# 3. Start Vibe
vibe                            # Launches interactive interface
# First run will ask to trust folder (one-time)

# OR: Manual install
curl -fsSL https://vibe.mistral.ai/install.sh | sh
cp .env.example .env
# Edit .env: set MISTRAL_API_KEY
vibe
```

### Why This Works Seamlessly

1. **Automated installer** (`bin/install-udos-vibe.sh`) handles all setup steps
2. **Vibe CLI** reads `.vibe/config.toml` (committed), discovers MCP servers, tools, skills at startup
3. **SETUP/REPAIR commands** auto-heal missing directories, seed data, etc. (accessible via Vibe bash tool or shell)
4. **SEED command** bootstraps vault on first `ucode SETUP CHECK`
5. **Trust folder system** asks once, stores in `~/.vibe/trusted-folders`
6. **MCP bridge** (`wizard/mcp/mcp_server.py`) routes Vibe tools ‚Üí uDOS commands automatically

---

## üõ† Phase A Scaffolding Prerequisites

### What You Need Before Starting

| Item | Status | Notes |
|------|--------|-------|
| Vibe BaseTool class structure | ‚úÖ Ready | `vibe/core/tools/base.py` ‚Äî `run()` async method, JSON schema |
| ToolManager & MCP proxy | ‚úÖ Ready | Auto-discovers tools via `resolve_local_tools_dir()` |
| Skills markdown loader | ‚úÖ Ready | Frontmatter parser, auto-discovers .md files in skill_paths |
| Pydantic models | ‚úÖ Ready | v2 installed, BaseModel for args/results |
| uDOS CommandDispatcher | ‚úÖ Ready | `core/tui.dispatcher.CommandDispatcher` ‚Äî intact, single entry point |
| .vibe/config.toml | ‚úÖ Ready | MCP servers block, tool_paths, skill_paths all in place |
| Memory/vault bootstrap | ‚úÖ Ready | SEED command, SeedInstaller class |
| Environment setup | ‚úÖ Ready | .env.example, SETUP story, REPAIR fallback |

### What You'll Create

1. **vibe/core/tools/ucode/_base.py** ‚Äî shared UcodeBaseTool pattern
   ```python
   class UcodeBaseTool(BaseTool):
       """All uDOS calls go through _dispatch() ‚Üí CommandDispatcher."""
       def _dispatch(self, cmd: str) -> dict:
           from core.tui.dispatcher import CommandDispatcher
           return CommandDispatcher().dispatch(cmd)
   ```

2. **vibe/core/tools/ucode/*.py** ‚Äî 5 tool modules (spatial, system, data, workspace, content)
   - Each tool wraps a set of uDOS commands
   - Pydantic args/results models
   - ~20-30 lines per tool class

3. **vibe/core/skills/ucode/*.md** ‚Äî 5 skill files (help, setup, story, logs, dev)
   - Markdown frontmatter with invocation rules
   - Describe the skill for AI, don't repeat tool docs

4. **docs/PHASE-A-ROADMAP.md** ‚Äî implementation guide & Phase B upgrade path

---

## üí° Key Design Decisions for Phase A ‚Üí B

### Single Principle: _dispatch() Abstraction

Write all tool classes with this pattern:

```python
# Phase A: Direct dispatch
def _dispatch(self, command: str, **kwargs) -> dict:
    from core.tui.dispatcher import CommandDispatcher
    return CommandDispatcher().dispatch(command)

# Phase B (upgrade): Swap to MCP calls ‚Äî same JSON schema
def _dispatch(self, command: str, **kwargs) -> dict:
    return self.mcp_client.call_tool("ucode_dispatch", {"command": command})
```

**Result**: Mistral's function-calling interface never changes. Phase B is a transparent upgrade.

---

## Final Readiness Verdict

### ‚úÖ **READY FOR PHASE A**

- [x] Vibe tool/skill infrastructure is solid
- [x] uDOS self-healing is proven (SETUP, REPAIR, SEED)
- [x] Repository structure respects .gitignore conventions
- [x] Environment system is in place (MISTRAL_API_KEY, WIZARD_KEY, .env)
- [x] CommandDispatcher is the single uDOS routing point
- [x] No external dependencies missing
- [x] Trust folder system handles vibe security

### ‚è≥ Optional but Post-Phase A

- Richer seed data in vibe/core/skills/ (could grow over time)
- Wizard server running for Phase B MCP upgrade
- Bootstrap shell script (for user experience, not functional requirement)
- Custom agents/configurations

---

## Next Steps

1. **Phase A Start**: Create vibe/core/tools/ucode/ structure
2. **Tool Scaffolding**: Write 5 tool modules covering 40+ uDOS commands
3. **Skill Scaffolding**: Write 5 skill .md files for AI-guided interactions
4. **Phase B Roadmap**: Document MCP upgrade path (change _dispatch, register MCP server, retire Phase A tools)
5. **Testing**: Run uDOS SETUP + REPAIR + vibe startup together; verify tool discovery
