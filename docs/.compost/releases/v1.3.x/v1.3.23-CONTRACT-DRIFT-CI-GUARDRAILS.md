# v1.3.23 Contract Drift CI Guardrails

Status: active/implemented for Core Stabilization Round A (2026-02-15)

## Goal

Prevent unnoticed contract drift across map runtime, gameplay ingestion, and
TOYBOX adapter surfaces.

## Required Guardrails

1. Canonical event surface parity
- Ensure MAP canonical types remain aligned between:
  - `core/config/world_adapter_contract_v1_3_21.json`
  - gameplay ingestion handlers in `core/services/gameplay_service.py`
  - parity tests in `core/tests/world_adapter_contract_v1_3_21_test.py`

2. Mission objective manifest integrity
- Validate objective schema and required ids in:
  - `core/config/v1_3_23_mission_objectives.json`

3. Adapter lane ownership guard
- Fail CI if adapter payload shortcuts can directly mutate:
  - identity ownership
  - permissions
  - gate completion state

4. Replay determinism gate
- Replay a fixed fixture stream twice; fail on output checksum drift.

5. Debug-hygiene baseline gate
- Hardcoded path scan baseline clean
- deprecated/depreciated marker baseline clean
- duplicate-function scanner baseline clean
- unused private-function report produced and triaged artifact emitted

## CI Entrypoints (Round A)

- `python3 tools/ci/check_v1_3_23_contract_drift.py`
- `python3 tools/ci/check_v1_3_23_debug_round_a.py`
- `python3 -m pytest core/tests/v1_3_22_lens_parity_test.py`
- `python3 -m pytest core/tests/world_adapter_contract_v1_3_21_test.py`

## Failure Policy

- Any drift in required contract ids/types is `blocker`.
- Any determinism failure is `blocker`.
- Any missing debug report artifact is `required`.
