# v1.3.17 Plan: Sonic Screwdriver Extension + Sonic Stick Distributable

Last updated: 2026-02-15
Target release: v1.3.17

## Progress Snapshot (2026-02-15)

Completed:
- Ventoy-free cutover merged in `/sonic` submodule (legacy Ventoy scripts/config removed).
- Native UEFI contract alignment landed:
  - dataset/API field rename `ventoy` -> `uefi_native`
  - manifest label updates to `ESP` and native boot mode semantics
- Wizard/Core integration wiring updated for renamed Sonic fields and command/docs alignment.

Roadmapped (still open / partial):
- Phase 1:
  - extension manifest contract versioning and CI pin enforcement are partial.
- Phase 2:
  - Sonic route hardening is partial (DB aliases and route contracts landed; auth/rate-limit review pending).
- Phase 3:
  - Core `SONIC` UX docs/parity are partial (core path exists; broader tests/help parity pending).
- Phase 4:
  - standalone distributable build pipeline is implemented with manifest/checksum validation; signing remains open.
- Phase 5:
  - dedicated v1.3.17 Sonic release gates are wired; release sign-off execution remains partial.

## Goals

1. Ship Sonic Screwdriver as a first-class extension with explicit Core/Wizard integration points.
2. Ship Sonic Stick as a standalone, distributable USB image path with uDOS Core + Alpine build pipeline.
3. Keep Core/Wizard boundary intact:
   - Core: offline/local orchestration and UX.
   - Wizard: integration APIs, plugin catalog, device/db services.
4. Use public `/uDOS-sonic/` git submodule as canonical Sonic implementation source.

## Scope

### In scope
- Sonic extension packaging, registration, install/enable lifecycle.
- Sonic API surface hardening and integration with platform/library routes.
- Sonic Stick builder flow for Alpine-based bootable media.
- Validation and release gates for extension + distributable.
- Submodule-based source integration from `/uDOS-sonic/`.

### Out of scope
- Full container orchestration for all auxiliary services.
- Non-Alpine base image support.
- New cloud-only features unrelated to Sonic build/distribution.

## Architecture Targets

## Source of Truth (Submodule)

- Canonical Sonic code lives in public submodule path: `/uDOS-sonic/`.
- uDOS monorepo consumes Sonic via submodule pin (commit SHA), not copied source.
- Release process must bump submodule SHA and record it in build manifest.

### A) Sonic Screwdriver Extension (Integrated)

Primary integration points:

- Wizard routes:
  - `wizard/routes/sonic_plugin_routes.py`
  - `wizard/routes/platform_routes.py`
  - `wizard/routes/library_routes.py`
  - `wizard/routes/plugin_registry_routes.py`
- Wizard services:
  - Sonic device DB/service layer
  - Plugin repository and install pipeline
- Core:
  - Command surfaces that trigger Sonic status/sync actions (`SONIC ...`)
  - Hotkey/documentation mapping and automation logs
- Distribution:
  - `distribution/plugins/*` package artifacts and manifests
  - Sonic plugin payloads built from `/uDOS-sonic/`

Required behaviors:

- Sonic extension appears in plugin catalog with validation metadata.
- Install/enable/disable/uninstall paths are consistent across CLI + Wizard API.
- Sonic health/status endpoint reflects device DB readiness and capability checks.
- Versioned manifest with compatibility fields (`core_min`, `wizard_min`, schema version).

### B) Sonic Stick (Standalone/Distributable)

Primary integration points:

- Build scripts:
  - `distribution/alpine-core/*`
  - `distribution/remaster_iso.sh`
  - `bin/provision-index.sh`
  - Sonic-specific builder wrappers pulling from `/uDOS-sonic/`
- Packaging outputs:
  - ISO/USB artifacts under `distribution/builds/`
  - checksums + metadata manifest
- Runtime payload:
  - uDOS Core runtime
  - Required Sonic components
  - Alpine profile/config for diskless + persistent overlay mode

Required behaviors:

- Deterministic build command produces named release artifacts.
- Artifact manifest includes build id, git sha, package set, checksums.
  - includes `uDOS-sonic` submodule commit SHA
- Boot smoke path verifies uDOS Core startup and Sonic module availability.

## Work Breakdown

### Phase 1: Contract + Registry (P0)

- Define Sonic extension manifest contract version for v1.3.17.
- Add submodule pin policy (`/uDOS-sonic/` required, clean checkout, detached pin allowed in CI).
- Add/confirm plugin registry fields for Sonic capabilities:
  - `device_db_required`
  - `usb_builder`
  - `platform_targets`
- Enforce manifest validation in install path.

Deliverables:
- Updated plugin/extension schema docs.
- Validation tests for Sonic manifest.
- Submodule policy doc snippet + CI check for pinned SHA.

### Phase 2: Wizard Integration Hardening (P0)

- Finalize Sonic API endpoints and response contract:
  - health/status
  - sync/reindex
  - install-state introspection
- Ensure library and platform routes expose Sonic consistently.
- Add auth/rate-limit policy alignment for Sonic routes.

Deliverables:
- Route contract tests.
- CLI/API parity checks for Sonic operations.

### Phase 3: Core UX + Command Integration (P0)

- Ensure `SONIC` command flow maps to Wizard-owned Sonic services cleanly.
- Update help/docs/hotkey references to canonical syntax.
- Add failure guidance when Wizard/Sonic service unavailable.

Deliverables:
- Core command tests for Sonic command path.
- Updated user docs and examples.

### Phase 4: Sonic Stick Builder Pipeline (P0)

- Standardize Alpine builder entrypoint:
  - base Alpine prep
  - uDOS Core payload injection
  - Sonic package payload injection
  - image/USB emit
- Produce release artifacts:
  - `sonic-stick-v1.3.17-<build>.iso` (and/or raw USB image)
  - `checksums.txt`
  - `build-manifest.json`

Deliverables:
- Reproducible build script and runbook.
- Artifact verification script.
- Build manifest includes both root repo SHA and `/uDOS-sonic/` SHA.

### Phase 5: Validation + Release Gates (P0)

- CI jobs for:
  - Sonic extension manifest and route tests
  - Build script lint/smoke
  - artifact manifest/checksum validation
  - submodule SHA pin validation for `/uDOS-sonic/`
- Release checklist and sign-off criteria.

Deliverables:
- `docs/releases/v1.3.17-sonic-release-checklist.md`
- Passing required CI gates.

## Acceptance Criteria

### Sonic Screwdriver extension
- Extension can be listed/installed/enabled/disabled via Wizard APIs.
- Core command path can query/use Sonic features with clear fallback messaging.
- Manifest validation blocks incompatible or malformed package payloads.

### Sonic Stick distributable
- Build pipeline emits bootable artifact + checksums + manifest.
- Boot smoke confirms Core startup and Sonic extension availability.
- Build output is reproducible from documented command sequence.

## Risks and Mitigations

- Risk: Build drift between local machines.
  - Mitigation: pinned build toolchain + manifest fingerprints.
- Risk: Core/Wizard boundary regressions.
  - Mitigation: import boundary checks + contract tests.
- Risk: Plugin/runtime mismatch across versions.
  - Mitigation: explicit compatibility gates in manifest and installer.
- Risk: Submodule drift or accidental local dirty state.
  - Mitigation: CI check requiring pinned clean submodule state for release builds.

## Milestones

- [ ] M1: Contract and registry updates complete (partial).
- [ ] M2: Wizard Sonic integration tests green.
- [ ] M3: Core Sonic command UX complete (partial).
- [ ] M4: Sonic Stick build emits signed artifacts.
- [ ] M5: Release checklist complete and tagged v1.3.17.

## Proposed Commands/Entrypoints (for implementation)

- Extension lifecycle:
  - `PLUGIN install sonic-screwdriver`
  - `PLUGIN enable sonic-screwdriver`
  - `SONIC STATUS`
  - `SONIC SYNC`
- Builder lifecycle:
- `./distribution/alpine-core/build-sonic-stick.sh`
- `./distribution/remaster_iso.sh --input <base.iso> --output <sonic-stick.iso>`
- `git submodule update --init --recursive /uDOS-sonic`

## Integration Test Matrix

- Core without Wizard: Sonic commands return actionable unavailable message.
- Core + Wizard (no Sonic enabled): install guidance path works.
- Core + Wizard + Sonic enabled: status/sync paths succeed.
- Sonic Stick boot image: startup + Sonic status smoke passes.

## Documentation Updates Required

- `docs/roadmap.md` (v1.3.17 Sonic track)
- Sonic quickstart and operator runbook
- Plugin manifest spec references for Sonic package
- Distribution/build guide for Alpine-based Sonic Stick
- Submodule operations runbook (`init`, `update`, `pin`, `release bump`)
