# v1.3.21 World/Adapter Contract (Finalized)

Status: canonical (2026-02-15)

Machine-readable source of truth:
- `core/config/world_adapter_contract_v1_3_21.json`

This replaces ad-hoc draft usage and locks the pre-3D adapter boundary.

## Core Boundary

- uDOS owns identity, permissions, progression, and persistence.
- Adapters/lenses render and emit canonical events.
- Canonical location identity remains PlaceRef/LocId first.

## Canonical Event Surface

- `MAP_ENTER`
- `MAP_TRAVERSE`
- `MAP_INSPECT`
- `MAP_INTERACT`
- `MAP_COMPLETE`
- `MAP_TICK`

Each event is required to include:
- `ts`, `source`, `username`, `type`, `payload`

Payload requirements per event type are enforced by:
- `core/services/world_adapter_contract.py`
- `core/tests/world_adapter_contract_v1_3_21_test.py`

## Chunk Identity

Chunking remains 2D for v1.3.21:
- `<anchor>-<space>-<layer>-<col>`

3D shape metadata remains reserved and non-authoritative until v1.3.22.

## Permissions Mapping

Contract permission anchors:
- map runtime actions -> `gameplay.mutate`
- gate administration -> `gameplay.gate_admin`
- profile switching -> `toybox.admin`

## Compatibility and Budgets

- Dual-lens compatibility matrix:
  - `docs/specs/v1.3.21-DUAL-LENS-COMPAT-MATRIX.md`
- Benchmark and budget checks:
  - `tools/bench/benchmark_v1_3_21_runtime.py`
  - `tools/ci/check_v1_3_21_adapter_readiness.py`
