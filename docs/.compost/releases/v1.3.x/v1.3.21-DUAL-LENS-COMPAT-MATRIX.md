# v1.3.21 Dual-Lens Compatibility Matrix

Status: active readiness gate (2026-02-15)

Goal: enforce a shared canonical gameplay event surface between:
- TUI map lens (`core:map-runtime`)
- external adapter lens (`adapter:*`)

## Matrix

| Case | TUI map lens | External adapter lens | Canonical event | Required payload fields | Gameplay metric effect |
|---|---|---|---|---|---|
| Enter place | `PLAY MAP ENTER <place>` | adapter emits enter event | `MAP_ENTER` | `place_id`, `place_ref`, `chunk2d_id`, `location` | `map_enters += 1` |
| Traverse edge | `PLAY MAP MOVE <place>` | adapter move between PlaceRefs | `MAP_TRAVERSE` | `from_place_id`, `to_place_id`, `to_place_ref`, `terrain_cost`, `mode`, `chunk2d_id`, `location` | `map_moves += 1` |
| Inspect node | `PLAY MAP INSPECT` | adapter inspection action | `MAP_INSPECT` | `place_id`, `place_ref`, `location` | `map_inspects += 1` |
| Interact point | `PLAY MAP INTERACT <id>` | adapter interaction action | `MAP_INTERACT` | `place_id`, `place_ref`, `interaction_id`, `location` | `map_interactions += 1` |
| Complete objective | `PLAY MAP COMPLETE <id>` | adapter objective completion | `MAP_COMPLETE` | `place_id`, `place_ref`, `objective_id`, `location` | `map_completions += 1`, `missions_completed += 1` |
| Tick/update | `PLAY MAP TICK [steps]` | adapter update/tick loop | `MAP_TICK` | `steps`, `tick_counter`, `npc_phase`, `world_phase`, `place_id`, `place_ref`, `location` | `map_ticks += 1` |

## Test Harness

- Contract loader/validator: `core/services/world_adapter_contract.py`
- Matrix tests: `core/tests/world_adapter_contract_v1_3_21_test.py`
  - validates TUI-emitted events against canonical contract
  - validates simulated external adapter events are ingested with same metric side effects

## Pass Criteria

1. All six canonical event types are validated against contract-required fields.
2. Gameplay metric increments are identical for TUI and adapter event streams.
3. No lens-specific payload keys are required for canonical ingestion.
