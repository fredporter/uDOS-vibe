# Configuration Structure

This directory holds all application configuration migrated from `.env`.

## Files

| File | Purpose | When to Create |
|------|---------|---|
| `config.toml` | Application settings (logging, UI, locale, dev flags) | Copy from `config.toml.example` after first setup |
| `config.toml.example` | Template with all available options | Reference only—do not edit |

## Moved Variables

The following variables moved **from `.env` to `config.toml`**:

### Locale
- `UDOS_TIMEZONE` → `[locale].timezone`
- `UDOS_LOCATION` → `[locale].location`
- `UDOS_LOCATION_NAME` → `[locale].location_name`
- `UDOS_GRID_ID` → `[locale].grid_id`

### Logging
- `UDOS_LOG_LEVEL` → `[logging].level`
- `UDOS_LOG_DEST` → `[logging].destination`
- `UDOS_LOG_FORMAT` → `[logging].format`
- `UDOS_LOG_PAYLOADS` → `[logging].payloads`
- `UDOS_LOG_REDACT` → `[logging].redact`
- `UDOS_LOG_RING` → `[logging].ring_buffer`
- `UDOS_LOG_SAMPLING` → `[logging].sampling`
- `UDOS_LOG_CATEGORIES` → `[logging].categories`
- `UDOS_LOG_ROOT` → `[logging].root`

### UI (TUI)
- `UDOS_QUIET` → `[ui.tui].quiet`
- `UDOS_NO_ANSI` → `[ui.tui].no_ansi`
- `UDOS_EMOJI_TUI_RENDER` → `[ui.tui].emoji_render`
- `UDOS_TUI_CLEAN_STARTUP` → `[ui.tui].clean_startup`
- `UDOS_LAUNCHER_BANNER` → `[ui.tui].show_banner`
- `UDOS_STORY_FORM_TUI` → `[ui.tui].form_tui`
- `UDOS_TUI_STARTUP_EXTRAS` → `[ui.tui.display].startup_extras`
- `UDOS_TUI_FULL_METERS` → `[ui.tui.display].full_meters`
- `UDOS_TUI_INVERT_HEADERS` → `[ui.tui.display].invert_headers`
- `UDOS_TUI_MAP_LEVEL` → `[ui.tui.display].map_level`
- `UDOS_TUI_FORCE_STATUS` → `[ui.tui.display].force_status`
- `UDOS_KEYMAP_PROFILE` → `[ui.tui.display].keymap_profile`

### Application
- `OS_TYPE` → `[app].os_type`
- `UDOS_VIEWPORT_COLS` → `[app].viewport_cols`
- `UDOS_VIEWPORT_ROWS` → `[app].viewport_rows`
- `UDOS_COMPOST_MAX_BYTES` → `[app.cleanup].compost_max_bytes`
- `UDOS_COMPOST_MAX_MB` → `[app.cleanup].compost_max_mb`
- `UDOS_COMPOST_RESERVE_MB` → `[app.cleanup].compost_reserve_mb`
- `OLLAMA_HOST` → `[app.services].ollama_host`
- `VIBE_STREAM_DELAY_MS` → `[app.services].stream_delay_ms`

### Development
- `UDOS_DEV_MODE` → `[dev].dev_mode`
- `UDOS_TEST_MODE` → `[dev].test_mode`
- `UDOS_AUTOMATION` → `[dev].automation`
- `UDOS_DEFAULT_USER` → `[dev].default_user`
- `UDOS_HOME_ROOT_ENFORCE` → `[dev].home_root_enforce`
- `UDOS_SKIP_DEP_CHECK` → `[dev].skip_dep_check`
- `UDOS_DISABLE_DEP_WARNING_MONITOR` → `[dev].disable_warning_monitor`
- `UDOS_OLLAMA_AUTOSTART` → `[dev].ollama_autostart`
- `UDOS_SESSION_ID` → `[dev].session_id`

### Providers
- `VIBE_PRIMARY_PROVIDER` → `[providers].primary`
- `VIBE_SECONDARY_PROVIDER` → `[providers].secondary`

## What Stays in `.env`

Only **startup essentials** remain in `.env`:
- `UDOS_ROOT` - Repository root (needed at Python startup)
- `VAULT_ROOT` - Framework vault location
- `VAULT_MD_ROOT` - Markdown vault alias
- `USER_NAME` - Identity (set by SETUP)
- `WIZARD_BASE_URL` - Wizard server endpoint
- Dev flags (UDOS_DEV_MODE, UDOS_TEST_MODE, UDOS_AUTOMATION, UDOS_DEFAULT_USER)

## What Goes in Secrets

All API keys and credentials go in **wizard/secrets.tomb** (encrypted):
- `MISTRAL_API_KEY` → Wizard dashboard > Settings > Integrations > Mistral
- `EMPIRE_API_TOKEN` → Wizard dashboard > Settings > Integrations > Empire
- `WIZARD_ADMIN_TOKEN` → Auto-generated by SETUP (do not set manually)

## Security & Path Handling

**Important:** Do not use shell-style variable references like `${UDOS_ROOT}` in `config.toml`.

When the config loader is implemented, it should:
- Read paths from config values as plain strings
- Expand `UDOS_ROOT` environment variable in code (Python side)
- Never rely on shell expansion of config file contents

**Why:** If a tool or script is executed in an environment where `UDOS_ROOT` is not set, literal `${UDOS_ROOT}` directories can be created accidentally.

## Loading Priority

When starting uDOS:
1. `.env` is loaded (environment variables)
2. `config.toml` is loaded (app settings override env)
3. `core/services/` load remaining settings
4. `wizard/secrets.tomb` is decrypted for secrets

## Setup Steps

```bash
# 1. Initialize environment
cp .env.example .env
# Edit .env: set UDOS_ROOT, USER_NAME, etc.

# 2. Initialize config
cd core/config
cp config.toml.example config.toml
# Edit config.toml as needed (optional—defaults work for most)

# 3. Run first-time setup
python uDOS.py
# This runs the SETUP story which generates wizard/secrets.tomb
```

## See Also

- `docs/devlog/2026-02-24-testing-phase-verification.md` - Environment audit
- `docs/specs/ENV-STRUCTURE-V1.1.0.md` - Full specification (if exists)
